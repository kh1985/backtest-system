# 2026-02-06 セッションログ

## minaraai自動取引ログの分析

ユーザーがminaraai（自動取引AI）の判断ログを持ち込み、Prismに活かせないか検討。

### minaraaiのロジック概要

- **マルチTF統合判断**: 4H（トレンド方向）→ 15m（エントリータイミング）→ 3m（精度）
- **使用インジケーター**: EMA20/50, MACD, RSI7/RSI14, Volume, OI, Funding Rate
- **判断フレームワーク**:
  1. Sharpe Ratioで実行モード切替（低い→保守的、高い→攻める）
  2. 既存ポジション確認 → 新規シグナル検出
  3. 銘柄別に信頼度スコア（0-100）を算出、閾値≥70で実行
  4. 条件未達なら「待つ」判断が可能
- **対象**: BTC, ETH, SOL（3銘柄同時監視）
- **分析時の状況**: 全3銘柄が4H下落トレンド内で15m反発中 → 全銘柄「待ち」判断

### Prism vs minaraai 比較結論

| 領域 | Prismが強い | minaraaiが強い |
|------|------------|---------------|
| 戦略探索 | 21テンプレート × グリッド/GA × exit profiles | 固定ロジック1つ |
| 過学習検出 | OOS/WFA/CV | なし |
| 統計的検証 | 30銘柄横断バッチ | 3銘柄個別 |
| リアルタイム判断 | なし（バックテストのみ） | 即時売買判断 |
| 複合条件の質 | 瞬間スナップショット | 状態の推移を読む |
| 「待つ」判断 | なし（条件合えば常にエントリー） | 信頼度閾値で見送り可 |
| OI/Funding | 未対応 | 判断材料として使用 |

**本質**: Prism=研究者（統計的発見）、minaraai=トレーダー（リアルタイム文脈判断）。補完関係。

---

## Modal本番実行 & 結果分析

### 実行概要
- **Run ID**: 20260206_105242
- **5銘柄 × OOS × 全exit profiles**: 528,885コンボ（各105,777）
- **実行時間**: 738秒（12.3分）
- **ローカル推定**: 3時間 → Modal 5並列で約5倍高速

### 5銘柄分析結果

| 銘柄 | Uptrend | Range | Downtrend | ベスト |
|------|---------|-------|-----------|--------|
| BTCUSDT | FAIL | FAIL | FAIL | なし |
| ETHUSDT | FAIL | PASS +0.7% | FAIL | range/volume_spike_short |
| BNBUSDT | PASS +0.29% | PASS +1.5% | PASS +4.04% | **downtrend/ma_crossover** |
| SOLUSDT | FAIL | FAIL | PASS +0.12% | ほぼゼロ |
| XRPUSDT | FAIL | PASS +3.30% | FAIL | range/stochastic_reversal_short |

### 主要な発見
- **レジーム傾向**: range > downtrend > uptrend（2/1結果と一致）
- **bb_exit_atr_sl20** がOOS通過した2戦略で共通 → 信頼できるexit profile候補
- **BTC/ETH**: エッジ発見が最も難しい（流動性高い＝非効率性少ない）
- **BNB**: 唯一3レジーム全通過（中規模アルトの特性か）
- **推奨戦略**: ランキングで0件（銘柄数1のため推奨基準未達）

---

## Modal直接データ取得スクリプト実装

### `scripts/modal_fetch_data.py`（新規作成）
- Binance data.binance.vision → Modal Volume に直接ダウンロード
- ローカルCSVダウンロードが不要に
- 銘柄ごとに`.spawn()`で並列実行
- `--list`フラグでVolume内の既存データ確認可能

### 完全クラウドワークフロー
```
modal run scripts/modal_fetch_data.py     # データ取得（Binance → Volume）
modal run scripts/modal_optimize.py       # 最適化実行
modal run scripts/modal_download.py       # 結果DL
```

---

## Modalスクリプト一覧

| スクリプト | 用途 |
|-----------|------|
| `scripts/modal_fetch_data.py` | Binance → Modal Volumeに直接データDL |
| `scripts/modal_upload.py` | ローカルCSV → Modal Volumeアップロード |
| `scripts/modal_optimize.py` | Modal上でバッチ最適化実行 |
| `scripts/modal_download.py` | Modal Volume → ローカルに結果DL |

### Windows注意点
- Pythonパス: `C:\Users\k-hachiya\AppData\Local\Programs\Python\Python312\python.exe`
- cp932エンコーディング問題: `PYTHONUTF8=1 PYTHONIOENCODING=utf-8` を付ける

---

## 次回やること

### minaraaiロジックのバックテスト検証
1. 新テンプレート「Downtrend Bounce Short」追加（RSI7 > 70 + MACD bearish crossover）
2. RSI7 パラメータ範囲拡張（10〜30 → 7〜30）
3. EMA Crossover テンプレート追加
4. 30銘柄OOS検証で統計的裏付け確認

### Modal運用改善
- `modal_fetch_data.py` のテスト実行
- データ期間の拡張検討（2024年からのデータ等）
- 推奨戦略基準の見直し（銘柄数1でも条件緩和するか）

---

## 参考: 前回OOS検証結果（2026-02-01）

- **Range + macd_signal_short**: 85%通過（最有力）
- **Downtrend + volume_spike_short**: 67%通過
- **Uptrend全般**: ほぼ全滅（過学習）

→ 今回の5銘柄結果でも range > downtrend > uptrend の傾向が再確認された。
